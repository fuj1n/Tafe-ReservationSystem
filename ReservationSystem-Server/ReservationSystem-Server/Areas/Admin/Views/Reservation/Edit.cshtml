@using ReservationSystem_Server.Areas.Admin.Models.Reservation
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model ReservationSystem_Server.Areas.Admin.Models.Reservation.EditViewModel

@{
    ViewBag.Title = "Edit Reservation";
}

<h2>Edit Reservation</h2>
<b>For sitting from @Model!.SittingStart to @Model.SittingEnd</b>
<hr/>
<a asp-action="Sitting" asp-route-id="@Model.SittingId" class="btn btn-outline-danger mb-2">Back to Sitting</a>

<form method="post">
    <div asp-validation-summary="All" class="alert alert-danger"></div>

    <div class="form-group">
        <label asp-for="StartTime" class="form-label"></label>
        <div class="input-group" id="time-display">
            <a class="btn btn-outline-primary" id="edit-time">Edit</a>
            <input type="text" class="form-control" disabled readonly value="@Model.StartTime.ToShortTimeString()"/>
        </div>
        <div class="visually-hidden" id="time-select">
            <div class="list-group list-group-horizontal-lg">
                @foreach (TimeSlot timeSlot in Model.TimeSlots!)
                {
                    <a class="list-group-item list-group-item-action select-time-slot" 
                       data-time="@timeSlot.Time" data-display="@timeSlot.Display" style="cursor: pointer;">
                        @timeSlot.Display
                    </a>
                }
            </div>
        </div>
    </div>
    <div class="form-group">
        <label asp-for="Duration" class="form-label"></label>
        <input asp-for="Duration" class="form-control"/>
        <span asp-validation-for="Duration" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Origin" class="form-label"></label>
        <select asp-for="Origin" asp-items="Model.AvailableOrigins" class="form-select">
            <option value="">-- Please Select --</option>
        </select>
        <span asp-validation-for="Origin" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="NumGuests" class="form-label"></label>
        <input asp-for="NumGuests" class="form-control"/>
        <span asp-validation-for="NumGuests" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Notes" class="form-label"></label>
        <textarea asp-for="Notes" rows="5" class="form-control" style="resize: none;"></textarea>
        <span asp-validation-for="Notes" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-primary mt-2">Edit Reservation</button>

    <div class="visually-hidden invisible" aria-hidden="true">
        <input type="hidden" asp-for="SittingId"/>
        <input type="hidden" asp-for="SittingStart"/>
        <input type="hidden" asp-for="SittingEnd"/>

        <input type="hidden" asp-for="ReservationId"/>
        
        <input type="hidden" asp-for="StartTime"/>
    </div>
</form>

@section Scripts
{
    <script>
        $(() => {
            $('#edit-time').click(() => {
                $('#time-display').addClass('visually-hidden');
                $('#time-select').removeClass('visually-hidden');
            });

            $('.select-time-slot').click(function() {
                $('#time-display').removeClass('visually-hidden');
                $('#time-select').addClass('visually-hidden');

                $('#time-display input').val($(this).attr('data-display'));
                $('#StartTime').val($(this).attr('data-time'));
            });
        });
    </script>
}
